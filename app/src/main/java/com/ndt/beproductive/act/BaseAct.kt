package com.ndt.beproductive.act

import android.os.Bundle
import android.util.Log
import android.view.View
import android.view.animation.AnimationUtils
import android.widget.Toast
import androidx.appcompat.app.AppCompatActivity
import androidx.lifecycle.ViewModel
import androidx.lifecycle.ViewModelProvider
import androidx.viewbinding.ViewBinding
import com.ndt.beproductive.OnDialogCallBack
import com.ndt.beproductive.OnMainCallBack
import com.ndt.beproductive.OpenGallery
import com.ndt.beproductive.R
import com.ndt.beproductive.fragment.BaseFrag


abstract class BaseAct<V : ViewBinding, M : ViewModel> : AppCompatActivity(), View.OnClickListener,
    OnMainCallBack, OnDialogCallBack, OpenGallery {

    companion object {
        val TAG: String = BaseAct::class.java.name
    }

    protected lateinit var binding: V
    protected lateinit var viewModel: M

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        binding = initViewBinding()
        setContentView(binding.root)
        viewModel = ViewModelProvider(this)[getClassVM()]
        Log.i(TAG, "BaseAct")
        initViews()
    }

    override fun showFrag(tag: String, data: Any?, isBacked: Boolean) {
        try {
            val clazz = Class.forName(tag)
            Log.i(TAG, "NAME TAG: $tag")
            val ctor = clazz.getConstructor()
            val baseFragment: BaseFrag<*, *> = ctor.newInstance() as BaseFrag<*, *>
            baseFragment.setCallBack(this)
            baseFragment.setData(data)
            val transaction = supportFragmentManager.beginTransaction().replace(
                R.id.fr_main, baseFragment, tag
            )
            if (isBacked) {
                transaction.addToBackStack(null)
            }
            transaction.commit()
        } catch (e: Exception) {
            e.printStackTrace()
        }
    }

    abstract fun initViewBinding(): V

    abstract fun initViews()

    abstract fun getClassVM(): Class<M>


    override fun onClick(v: View?) {
        v?.startAnimation(
            AnimationUtils.loadAnimation(
                this, com.google.android.material.R.anim.abc_fade_in
            )
        )
        clickViews(v)
    }

    protected open fun clickViews(v: View?) {
        // dung thi ghi de lai.
    }


    override fun backPrevious() {
        onBackPressedDispatcher.onBackPressed()
    }

    protected open fun callBack() {
        // dung de ghi de lai.
        // callBack nay la de dung cho Dialog.
    }


    protected open fun showNotify(msg: String?) {
        Toast.makeText(this, msg, Toast.LENGTH_LONG).show()
    }

    protected open fun showNotify(msgID: Int) {
        Toast.makeText(this, msgID, Toast.LENGTH_LONG).show()
    }

}